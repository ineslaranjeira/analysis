function outp = dataset2table(D, ses)

% convert ONE dataset into an easy-to-work-with behavioral table
varnames    = regexprep(D.dataset_type, '_ibl_trials.', '');
s           = cell2struct(D.data, varnames);

% add some useful things
s.signedContrast = s.contrastLeft - s.contrastRight;
s.rt             = s.response_times - s.stimOn_times;
s.correct        = double(sign(s.signedContrast) == s.choice);
s.contrastRight(s.signedContrast == 0) = NaN;

% metadata from 'ses'
sesflds = {'subject', 'location', 'lab', 'start_time', 'end_time'};
for sidx = 1:length(sesflds),
    s.(sesflds{sidx})          = repmat(ses.(sesflds{sidx}) , length(s.choice), 1);
end

% if possible, convert
if ~verLessThan('matlab','8.2')
    outp = struct2table(s);
else
    outp = s;
end

end
